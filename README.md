Webtorio - бекэнд Web API моей вариации игры Factorio.

Фронта нет, протестировать можно через встроенный Swagger и/или Postman - файл для него с импортированным конфигом лежит в корне.

------------------------------------------------------------------------------------------------------------------------------------------

Основная логика, правила:

Тикрейт: 1 тик/1 сек.

Все добытые ресурсы, произведенные материалы, а также созданные здания хранятся на складе.
На склад они попадают автоматически после добычи/производства/создания.

Deposit.
Депозит (Deposit) - залежь ресурсов. Каждый депозит имеет свои собственные слоты, для добывающих (ExtractiveBuilding) зданий.
Депозит при исчерпании выключает все здания, перемещает обратно их на склад, и удаляется.

Slot.
Слот (Slot) - для размещения здания. В 1 слоте может быть только одно здание.
Всего есть 2 типа слотов:
1) Общий слот (NonDepositSlot) - для размещения в нем производственных (ManufactureBuilding) и генерирующих (GeneratorBuilding) зданий.
2) Слот депозита (DepositSlot) - привязан к определенному депозиту. Предназначен для размещения в нем только добывающих зданий.

Buildings.
Все здания изначально после создания хранятся на складе.
Делятся на 3 типа:
1) Extractive - добывающие ресурсы из депозитов здания, могут размещаться только в Deposit слотах.
2) Manufacture - производственные здания для создания материалов из ресурсов. После размещения в слоте требуется выбрать нужный рецепт
   для работы.
3) Generator - относящиеся к генерации электроэнергии, или добывающие воду здания.

Для начала использования здание нужно разместить в слот.
После размещения можно включить, предварительно выбрав нужный рецепт в случае производственных зданий (ManufactureBuilding).
В основе поведения зданий лежит конечный автомат (State machine). Можно ориентироваться на состояние (State) здания для понимания,
что сейчас с ним происходит, или чего ему не хватает для работы.

Energy.
Энергия в игре делится на 2 типа:
1) Burner - энергия от сжигания. Можно выбрать тип ресурса, на данный момент их два: уголь (Coal) и коксовый уголь (Coke Coal).
   По умолчанию такие здания потребляют уголь. Нужный ресурс автоматически берется со склада и сжигается,
   давая зданию энергию на зависящее от энергоемкости ресурса (FuelValueMJ), количество тиков.
2) Electric - электричество. В игре общая электрическая энергосеть.

Здания потребляют разное кол-во энергии, в зависимости от их EnergyConsumptionKW.
Генерирующие здания не потребляют энергию. Добывающие и производственные потребляют оба типа энергии. Какой именно тип — зависит от здания.

------------------------------------------------------------------------------------------------------------------------------------------

Пошаговый вариант для тестирования части функций. Для более глубокого понимания рекомендуется прочитать и/или заглядывать в основную
логику и правила игры выше.

Из IDE запускаем проект в режиме отладки. Запускаем Postman, файл для него (Webtorio Api.postman_collection.json) с экспортированным
конфигом лежит в корне, или работаем через Swager, он откроется сам.

Для начала можно построить 4 добывающих дрели на депозите угля, чтобы они обеспечивали сами себя топливом (углём) и оставалось ещё немного
для других зданий:

1) Вызываем Buildings available to create, здесь мы видим доступные типы зданий для постройки, и тип потребляемой ими энергии.
   Берем отсюда id типа здания Burner Mining Drill: 100.

2) Создаем здания: 4 раза передаем запрос Create Building с телом {"buildingTypeId": X} где вместо X подставляем id нужного нам типа здания.
   Каждый раз в ответ нам приходят данные по только что созданному зданию. Запоминаем/записываем их id, в моем случае это от 1 до 4.
   1) Либо можем посмотреть id созданных и доступных сейчас на складе зданий, через вызов Get Stored/Extractive Building в нашем
       случае т.к. Burner Mining Drill (и Electric Mining Drill) относится к добывающим здания.
       После вызова Get Stored/Extractive Building ({{host}}/buildings/stored/extractive) мы увидим хранящиеся на складе здания
       этой категории, по одному на каждый тип.

3) Для получения списка всех доступных депозитов вызываем Get all Deposits ({{host}}/deposits), смотрим нужный нам id у депозита угля,
   у меня это 1.

4) Получаем данные по конкретному депозиту, вызывая Get Deposit и передавая в адресной строке id интересующего нас депозита (угля)
   ({{host}}/deposits/1). В ответе мы видим данные по всем слотам и зданиям в этом депозите.
   1) Смотрим у депозита id 4-ёх свободных слотов для наших зданий, у меня это с 19 по 22.

5) Далее, чтобы разместить наши здания в слотах вызываем Add Building to Slot, в адресной строке поочередно добавляя каждое здание в пустой
   слот: ({{host}}/slots/19/add-building/1) в примере 19 это id слота и 1 это id здания, также делаем для остальных 3.

6) После можно проверить что здания в слотах получив данные как в пункте 4
   1) Или проверить отдельно каждое здание по слоту в котором оно размещено, вызвав Get Slot, отправив в адресной строке id
       интересующего нас слота, в примере 19 ({{host}}/slots/19). В ответе видим данные по слоту и зданию размещенному в нем.
       Сейчас статус здания должен быть Off.

7) Теперь можно включить здания. Вызываем Building switch On/Off и включаем каждое здание передавая его id в адресной строке, в примере
   это 1 ({{host}}/buildings/1/switch-on-off).

8) Можно проверить все здания в нужном нам депозите как в пункте 4, либо отдельно каждое здание через его слот (пункт 6.1),
   1) Либо просто отдельно каждое здание через вызов Get Building, передавая в адресной строке id интересующего нас здания,
       в примере это 2 ({{host}}/buildings/2). В ответе увидим что здания теперь в статусе NoEnergy, т.к. при попытке включиться на складе
       не было в данном случае угля.

9) Добудем немного угля сами руками (киркой) из депозита, чтобы запустить процесс, а после проверим (как в пункте 6.1) что здания в статусе
   On. Вызываем Mine Resource ({{host}}/deposits/1/mine-resource) подставляем нужный нам id депозита, в нашем случае 1, это депозит
   угля. В теле запроса передаем количество, которое хотим добыть, например 5 {"amount": 5}.

10) Здания включатся сами на следующем тике, как только смогут получить угль со склада. Теперь можно просто понаблюдать как иногда
    расходуется со склада для работы дрелей, или добывается и перемещается на него уголь, вызывая
    1) Get all Resources ({{host}}/storage/resources).
        Также можно проверить как исчерпывается месторождение ресурса вызвав все депозиты как в пункте 3.


Теперь мы например хотим поставить пару электрических буров на месторождение железа, чтобы в будущем при его переработке получить железные
плиты. Для этого сначала займёмся электричеством:

11) Смотрим как в пункте 1 id нужных нам типов зданий, и далее создаем их как в пункте 2:
    1) Offshore Pump: 105 это насос для получения воды. Создаем 1.
    2) Boiler: 106 это бойлер для нагрева и превращения воды в пар. Создаем 1.
    3) Steam Engine: 107 это паровой двигатель, который будет используя пар производить электрическую энергию. Их можно создать 2,
        т.к. бойлер обеспечивает паром два паровых двигателя.
    4) Данные какое здание к какому типу относится, и на какой энергии работает — можно увидеть как в момент создания, так например
        и вызвав по id уже созданное определенное здание, как в пункте 8.1.
    5) Данные сколько и чего производит и что потребляет для этого здание, можно взять оттуда же как и в пункте 11.4, будет виден
        Output и Input в количестве, и id типа ресурса (resourceTypeId). После можно вызвать Get Resource передав этот id в
        адресной строке (например {{host}}/storage/resource/90), и получить данные по этому типу ресурса.

12) Далее размещаем и включаем эти здания в слотах, но уже не в слотах депозита, а обычных, т.к. это генерирующий тип зданий
    (GeneratorBuilding, информация по этому есть в описании слотов, выше в логике и правилах).
    1) Для этого вызываем Get All Non Deposit Slots ({{host}}/slots/all-non-deposit).
       1) И берем отсюда id несколько пустых слотов, в нашем случае нам их нужно сейчас 4.
    2) Вспоминаем id созданных зданий, или получаем их аналогично как в пункте 2.1, только используя Get Stored/GeneratorBuilding
        ({{host}}/buildings/stored/generator), т.к. эти здания генерирующего типа.
    3) Размещаем здания в слотах так же как и в пункте 5.
    4) Включаем здания как в пункте 7.
    5) Проверяем все здания вызвав снова Get All Non Deposit Slots (пункт 12.1). Все они должны быть включены (State On) т.к.
        насосу энергия не требуется, Бойлер потребляет уголь, а он у нас уже добывается, Паровой двигатель работает на уже
        имеющемся пару от Бойлера.

13) После можем проверить количество ресурсов на складе вызвав Get all Resources ({{host}}/storage/resources), и увидеть что появились
    новые ресурсы:
    1) Water Pressure - давление воды, оно используется каждым бойлером.
    2) Steam Pressure - давление пара, он используется каждым паровым двигателем.
    3) Available Electricity - доступное электричество, используется всеми зданиями которые потребляют электричество.
        Все эти три ресурса работают по принципу общей сети/труб, т.е. мы в итоге видим их сальдо.


Зная что бойлер потребляет достаточно много топлива в виде угля на превращение воды в пар, можем перевести его на более выгодный тип
топлива — коксовый уголь ("Coke Coal"):

14) В начале для этого построим Electric Furnace, можно, конечно, построить любую другую печь, но электрическая более энергоэффективна.
    Как в пункте 1 получаем id интересующего нас типа здания Electric Furnace: 104. Далее создаем это здание (пункт 2). После берем id
    обычного пустого слота (пункт 12.1) где хотим его разместить.
    1) Вспоминаем id созданного здания, или получаем его аналогично как в пункте 2.1, только используя
        Get Stored/ManufactureBuilding ({{host}}/buildings/stored/manufacture), т.к. это здание производственного типа.
    2) Далее размещаем здание в слот (пункт 5).
    3) Можно его сразу включить (пункт 7), но здания производственного типа не заработают пока не выберешь рецепт, это можно
        проверить после включения сделав пункт 12.1, увидим что у нашей электрической печи статус нет рецепта ("state": "NoRecipe").
    4) Получаем id нужного нам рецепта (Coke Coal) из ответа, вызвав Available Recipes и передав id интересующего нас здания,
        в примере это 13 ({{host}}/buildings/13/available-recipes). Тут мы также можем посмотреть какие рецепты доступны для
        данного типа зданий, сколько и каких ресурсов потребляется (inputItems) во время производства,
        и что получаем на выходе (outputItems).
    5) Выбираем нужный нам рецепт вызывая Select Recipe, передавая id здания (13 в примере) и id рецепта, в примере это 5
        ({{host}}/buildings/13/select-recipe/5).
    6) После можно проверить что здание перешло в режим On (пункт 8.1 или 12.1), и что на склад стал поступать коксовый уголь,
        вызвав Get all Resources (пункт 10.1) или
    7) Вызвав Get available Fuel ({{host}}/storage/available-fuel).
    8) Теперь получаем id нашего бойлера (пункт 12.1) и id типа ресурса (ResourceTypeId) коксового угля (пункт 14.7).
    9) Для смены топлива вызываем Change Building Fuel передавая id здания (в примере 13) и id типа ресурса, в примере это 10
        ({{host}}/buildings/13/change-fuel/10).


Теперь запустим добычу железной руды:

15) Как в пункте 1 получаем id интересующего нас типа здания Electric Mining Drill: 101. Далее создаем 2 таких здания (пункт 2). После
    смотрим id нужного нам депозита железа (пункт 3), берем из него пару свободных слотов (пункт 4 и 4.1), вспоминаем id созданных
    зданий или смотрим (пункт 2.1), и размещаем в этих слотах наши дрели (пункт 5). Теперь включаем их (пункт 7).

16) После можем проверить что у нас осталось еще меньше доступного электричества (пункт 13).


И наконец запустим выплавку железных плит из руды в электрической печи:

17) Проходим те же шаги как в пунктах 14.1 - 14.5, только выбираем рецепт Steel Plate. Далее можем проверить как железные плиты начинают
    поступать на склад (10.1).


При желании ещё например проверить как здания переходят из статуса в статус при недостатке материалов для производства рецептов, энергии и
прочего. И как они сами возвращаются в строй и продолжают работу при появлении на складе этих ресурсов. Или как удаляется депозит
при исчерпании и его буры попадают на склад.


Все готово! Основные элементы, реализованные на данный момент мы посмотрели. 

Спасибо, что дошли до сюда!